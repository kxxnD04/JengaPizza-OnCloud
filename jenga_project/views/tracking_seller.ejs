<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçï</text></svg>">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <title>Jenga Pizza</title>
    <style>
        @font-face {
            font-family: Prompt;
            src: url("fonts/Prompt-Regular.ttf");
        }

        body {
            font-family: Prompt;
        }

        /* Background Image */
        body::before {
            content: "";
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: url("images/bg-pizza.jpg");
            opacity: 0.1;
            z-index: -1;
        }

        .box {
            text-align: center;
            width: 100%;
        }
        .btn-update {
            background-color: rgb(187, 62, 0);
            color: white;
        }

        .btn-update:hover {
            background-color: rgb(160, 50, 0);
            color: white;
        }
        /* Fix Flexbox Centering */
        .container-center {
            margin: auto;
            display: flex;
            align-items: center;
            /* Ensure vertical centering */
            width: 80%;
            min-height: calc(100vh - 60px);
            /* Adjust for navbar */
            padding-top: 60px;
            /* Prevent overlap with navbar */
            padding-bottom: 60px;
        }

        .order-icon {
            width: 80px;
            height: 80px;

        }

        .status-dropdown {
            width: 100%;
            cursor: pointer;
        }

        /* Filter Section Styles */
        .filter-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .filter-title {
            font-weight: bold;
            color: rgb(187, 62, 0);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
        }

        .filter-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .filter-input, .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: Prompt;
            transition: border-color 0.3s;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: rgb(187, 62, 0);
        }

        .btn-filter {
            background-color: rgb(187, 62, 0);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: Prompt;
            transition: background-color 0.3s;
        }

        .btn-filter:hover {
            background-color: rgb(160, 50, 0);
        }

        .btn-reset {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: Prompt;
            transition: background-color 0.3s;
        }

        .btn-reset:hover {
            background-color: #5a6268;
        }

        @media (max-width: 768px) {
            .filter-controls {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <header>
        <%- include('header') %>
    </header>

    <!-- choose to buy -->
    <div class="container-center">
        <div class="container mt-4">
            <h2 class="font-weight-bold">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

            <!-- Filter Section -->
            <div class="filter-container">
                <div class="filter-title">üîç ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <div class="filter-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Order ID</div>
                        <input type="number" id="searchOrderId" class="filter-input" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Order...">
                    </div>
                    <div class="filter-group">
                        <div class="filter-label">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
                        <select id="filterStatus" class="filter-select">
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="pending">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (pending)</option>
                            <option value="preparing">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (preparing)</option>
                            <option value="delivering">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (delivering)</option>
                            <option value="success">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (success)</option>
                            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß (cancelled)</option>
                            <option value="rejected">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß (rejected)</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn-filter" onclick="applyFilter()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    </div>
                    <div>
                        <button class="btn-reset" onclick="resetFilter()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Order List -->
                <div class="col-md-12">
                    <div class="order-card" id="orderList">

                        <% for(var i=0; i < allder.length; i++) { %>

                            <div class="row align-items-center p-3 border rounded bg-white shadow-sm mb-3 order-item" 
                                 data-order-id="<%= allder[i].order_id %>" 
                                 data-order-status="<%= allder[i].order_status %>">
                                <div class="col-2">
                                    <% 
                                        let statusImage = allder[i].order_status;
                                        if (allder[i].order_status === 'cancelled' || allder[i].order_status === 'rejected') {
                                            statusImage = 'cancelled';
                                        }
                                    %>
                                    <img src="images/<%= statusImage %>.png" class="order-icon">
                                </div>
                                <div class="col-6">
                                    <h5 id="<%= allder[i].order_id %>">Order No. <%= allder[i].order_id %>
                                    </h5>
                                    <p class="text-muted">‡∏£‡∏≤‡∏Ñ‡∏≤ : <%= allder[i].total_price %> ‡∏ö‡∏≤‡∏ó</p>
                                    <p class="text-muted">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î : <%= allder[i].receiver_name %>, <%=
                                                allder[i].house_no %>
                                                <%= allder[i].village_no %>
                                                    <%= allder[i].street %>
                                                        <%= allder[i].sub_district %>
                                                            <%= allder[i].district %>
                                                                <%= allder[i].province %>
                                                                    <%= allder[i].postal_code %>
                                                                        <%= allder[i].country %>
                                    </p>
                                    <a href="<%= allder[i].payment_proof %>" target="_blank">‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</a>
                                    <p class="text-muted timestamp">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠ : </p>
                                </div>
                                <div class="col-4 text-right">
                                    <% if (allder[i].order_status === 'pending') { %>
                                        <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö order ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                                        <div class="btn-group-vertical" style="width: 100%;">
                                            <button class="btn btn-success mb-2 btn-verify" data-order-id="<%= allder[i].order_id %>">
                                                ‚úì ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                            </button>
                                            <button class="btn btn-danger btn-reject" data-order-id="<%= allder[i].order_id %>">
                                                ‚úó ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                            </button>
                                        </div>
                                    <% } else if (allder[i].order_status !== 'cancelled' && allder[i].order_status !== 'rejected' && allder[i].order_status !== 'success') { %>
                                        <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö order ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
                                        <select class="form-control status-dropdown mb-2" data-order-id="<%= allder[i].order_id %>">
                                            <option value="preparing" <%= allder[i].order_status === 'preparing' ? 'selected' : '' %>>preparing</option>
                                            <option value="delivering" <%= allder[i].order_status === 'delivering' ? 'selected' : '' %>>delivering</option>
                                            <option value="success" <%= allder[i].order_status === 'success' ? 'selected' : '' %>>success</option>
                                        </select>
                                        <button class="btn btn-update">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</button>
                                    <% } else { %>
                                        <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö order ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß -->
                                        <span class="badge badge-<%= allder[i].order_status === 'success' ? 'success' : 'secondary' %> p-3">
                                            <%= allder[i].order_status === 'success' ? '‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 
                                                allder[i].order_status === 'cancelled' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß' : '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß' %>
                                        </span>
                                    <% } %>
                                </div>
                            </div>

                            <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
    <div class="modal fade" id="verifyPaymentModal" role="dialog" aria-labelledby="verifyPaymentModalLabel">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="verifyPaymentModalLabel">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <p class="text-muted">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å stock </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="confirmVerifyBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
    <div class="modal fade" id="rejectPaymentModal" role="dialog" aria-labelledby="rejectPaymentModalLabel">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="rejectPaymentModalLabel">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <p class="text-danger">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="confirmRejectBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <div class="modal fade" id="resultModal" role="dialog" aria-labelledby="resultModalLabel">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header" id="resultModalHeader">
                    <h5 class="modal-title" id="resultModalLabel">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="resultModalBody">
                    <!-- Message will be inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getCurrentDateTime() {
            const now = new Date();
            
            // Format date as DD/MM/YYYY
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            
            // Format time as hh:mm
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // Return formatted date and time
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        $(document).ready(function () {
            $('.timestamp').each(function() {
                $(this).text('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠ : ' + getCurrentDateTime());
            });
            
            let orderId = $(this).data('order-id');
            $(`select[data-order-id="${orderId}"]`).closest('.row').find('p.text-muted:last').text('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠ : ' + getCurrentDateTime());

        });

        // Filter and Search Functions
        function applyFilter() {
            const searchId = $('#searchOrderId').val().trim();
            const filterStatus = $('#filterStatus').val();

            $('.order-item').each(function() {
                const orderId = $(this).data('order-id').toString();
                const orderStatus = $(this).data('order-status');
                
                let showOrder = true;

                // Filter by Order ID
                if (searchId !== '' && orderId !== searchId) {
                    showOrder = false;
                }

                // Filter by Status
                if (filterStatus !== 'all' && orderStatus !== filterStatus) {
                    showOrder = false;
                }

                if (showOrder) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });

            // Show message if no orders found
            checkEmptyResults();
        }

        function resetFilter() {
            $('#searchOrderId').val('');
            $('#filterStatus').val('all');
            $('.order-item').show();
            $('#noResultsMessage').remove();
        }

        function checkEmptyResults() {
            const visibleOrders = $('.order-item:visible').length;
            
            $('#noResultsMessage').remove();
            
            if (visibleOrders === 0) {
                $('#orderList').append(
                    '<div id="noResultsMessage" class="text-center p-5">' +
                    '<div style="font-size: 3rem; opacity: 0.3;">üì≠</div>' +
                    '<p style="color: #6c757d; margin-top: 15px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>' +
                    '</div>'
                );
            }
        }

        // Enable Enter key for search
        $('#searchOrderId').on('keypress', function(e) {
            if (e.which === 13) {
                applyFilter();
            }
        });
    </script>

<script>
    $(".btn-update").on("click", function (e) {
      e.preventDefault(); // Prevent default behavior (form submission)
  
      // Get the ID of the parent .col-md-6 or appropriate parent element
      let order_id = $(this).closest(".row").find("h5").attr("id");
      
      // Get the selected value from the dropdown (order status)
      let orderStatus = $(this).closest('.row').find('.status-dropdown').val();
      console.log(orderStatus);

      fetch('/update_order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ order_id: order_id, order_status: orderStatus })
      })
        .then(response => response.json())
        .then(data => {
          console.log('Data:', data); // Log the server response
          if (data.success) {
            window.location.href = data.redirect;
          } else {
            alert('Error updating order status');
          }
        })
        .catch(error => console.error('Error:', error));
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    let selectedVerifyOrderId = null;

    $(".btn-verify").on("click", function (e) {
      e.preventDefault();
      selectedVerifyOrderId = $(this).data("order-id");
      $('#verifyPaymentModal').modal('show');
    });

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î Modal (‡∏õ‡∏∏‡πà‡∏° X)
    $('#verifyPaymentModal').on('hidden.bs.modal', function () {
      selectedVerifyOrderId = null;
    });

    $('#rejectPaymentModal').on('hidden.bs.modal', function () {
      selectedRejectOrderId = null;
    });

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó (X) ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î Modal ‡πÑ‡∏î‡πâ
    $('#verifyPaymentModal .close').on('click', function() {
      $('#verifyPaymentModal').modal('hide');
    });

    $('#rejectPaymentModal .close').on('click', function() {
      $('#rejectPaymentModal').modal('hide');
    });

    $('#resultModal .close').on('click', function() {
      $('#resultModal').modal('hide');
    });

    // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal
    $(document).on('click', '.modal', function(e) {
      if ($(e.target).hasClass('modal')) {
        $(this).modal('hide');
      }
    });

    $('#resultModal').on('hidden.bs.modal', function () {
      // Reset modal header class
      $('#resultModalHeader').removeClass('bg-success bg-danger text-white');
    });

    // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Modal
    $("#confirmVerifyBtn").on("click", function () {
      if (selectedVerifyOrderId) {
        // ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á request
        $('#verifyPaymentModal').modal('hide');
        
        fetch('/verify_payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ order_id: selectedVerifyOrderId })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              showResultModal('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
              setTimeout(() => {
                window.location.reload();
              }, 2000);
            } else {
              showResultModal('danger', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showResultModal('danger', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
          });
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    let selectedRejectOrderId = null;

    $(".btn-reject").on("click", function (e) {
      e.preventDefault();
      selectedRejectOrderId = $(this).data("order-id");
      $('#rejectPaymentModal').modal('show');
    });

    // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏à‡∏≤‡∏Å Modal
    $("#confirmRejectBtn").on("click", function () {
      if (selectedRejectOrderId) {
        // ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á request
        $('#rejectPaymentModal').modal('hide');
        
        fetch('/reject_payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ order_id: selectedRejectOrderId })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              showResultModal('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
              setTimeout(() => {
                window.location.reload();
              }, 2000);
            } else {
              showResultModal('danger', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showResultModal('danger', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
          });
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Result Modal
    function showResultModal(type, title, message) {
      $('#resultModalLabel').text(title);
      $('#resultModalBody').text(message);
      $('#resultModalHeader').removeClass('bg-success bg-danger').addClass('bg-' + type + ' text-white');
      $('#resultModal').modal('show');
    }
  </script>
  

    <footer>
        <%- include('footer') %>
    </footer>


</body>

</html>